$ErrorActionPreference= "SilentlyContinue";
$ProgressPreference = "SilentlyContinue";
$WarningPreference = 'SilentlyContinue';

if(Get-NfsServerConfiguration)
{
if((Get-NfsServerConfiguration).EnableNFSV4){
Set-NfsServerConfiguration -EnableNFSV4 $false
nfsadmin server stop | Out-Null
nfsadmin server start | Out-Null
Write-Output "Mitigation implemented for CVE-2022-34715 - NFSV4 has been disabled."
}
else{
Write-Host "NFSV4 is found to be disabled. No action required"
}
}
else{
Write-Host "NFS Server is not configured. No action required."
}