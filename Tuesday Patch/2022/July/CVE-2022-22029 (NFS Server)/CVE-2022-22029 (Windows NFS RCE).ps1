$ErrorActionPreference= "SilentlyContinue";
$ProgressPreference = "SilentlyContinue";
$WarningPreference = 'SilentlyContinue';

if(Get-NfsServerConfiguration)
{
    if((Get-NfsServerConfiguration).EnableNFSV3){
        Set-NfsServerConfiguration -EnableNFSV3 $false
        nfsadmin server stop | Out-Null
        nfsadmin server start | Out-Null
        Write-Output "Workaround implemented - NFSV3 has been disabled. CVE-2022-22029 is mitigated."
    }
    else{
        Write-Host "NFSV3 is found to be disabled. No action required"
    }
}
else{
    Write-Host "NFS Server is not configured. No action required."
}