os_name=$(cat /etc/os-release | awk -F '=' '/^NAME/{print $2}'| tr -d '"')

if [ "$os_name" == "CentOS" ]
then
        echo "system is CentOS"
        os_versionid=$(cat /etc/os-release | awk -F '=' '/^VERSION_ID/{print $2}' | awk '{print $1}' | tr -d '"')



       case $os_versionid in
                "7.*" )
                        echo "os version is $os_versionid"
                        yumcmd="yum install -y"



                           if ! rpm --quiet --query pax; then
                                yumcmd="$yumcmd pax"
                            fi
                        eval $yumcmd
                        su zimbra -
                        zmcontrol restart
                        ;;



               "8.*" )
                        echo "os version is $os_versionid"
                        dnfcmd="dnf install -y"



                           if ! rpm --quiet --query spax; then
                                dnfcmd="$dnfcmd spax"
                            fi
                        eval $dnfcmd
                        
                        su zimbra -
                        zmcontrol restart
                        ;;
        esac
elif [ "$os_name" == "Ubuntu" ]
then
        echo "System is Ubuntu"
        
        REQUIRED_PKG="pax"
        PKG_OK=$(dpkg-query -W --showformat='${Status}\n' $REQUIRED_PKG|grep "install ok installed")
        echo Checking for $REQUIRED_PKG: $PKG_OK
        if [ "" = "$PKG_OK" ]; then
          echo "No $REQUIRED_PKG. Setting up $REQUIRED_PKG."
          sudo apt-get --yes install $REQUIRED_PKG
        fi
        
        su zimbra -
        zmcontrol restart
else
        echo "System is $os_name"
        echo "Zimbra has provided workaround only for CentOS and Ubuntu. Refer https://blog.zimbra.com/2022/09/security-update-make-sure-to-install-pax-spax/"
fi
