$ErrorActionPreference= "SilentlyContinue";
$ProgressPreference = "SilentlyContinue";
$WarningPreference = 'SilentlyContinue';

if(Get-NfsServerConfiguration)
{
    if((Get-NfsServerConfiguration).EnableNFSV4){
        Set-NfsServerConfiguration -EnableNFSV4 $false
        nfsadmin server stop | Out-Null
        nfsadmin server start | Out-Null
        Write-Output "Workaround implemented - NFSV4 has been disabled. CVE-2022-30136 is mitigated."
    }
    else{
        Write-Host "NFSV4 is found to be disabled. No action required"
    }
}
else{
    Write-Host "NFS Server is not configured. No action required."
}