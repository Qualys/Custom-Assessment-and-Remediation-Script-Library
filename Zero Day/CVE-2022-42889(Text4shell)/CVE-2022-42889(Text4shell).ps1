# Download Text4Scan.zip file
Invoke-WebRequest -Uri "https://github.com/Qualys/text4scanwin/releases/download/1.0.0/Text4Scan.zip" -UseBasicParsing -OutFile $env:TEMP\Text4Scan.zip
# Unzip downloaded file
Expand-Archive $env:TEMP\Text4Scan.zip -DestinationPath $env:TEMP\

$Arch = (Get-Process -Id $PID).StartInfo.EnvironmentVariables["PROCESSOR_ARCHITECTURE"];
if ($Arch -eq 'x86') {
    # Start scan process
    cd $env:TEMP\Text4Scan\x86
    .\Text4Scan.exe /scan /report_sig | Out-Null
}
elseif ($Arch -eq 'amd64') {
    # Start scan process
    cd $env:TEMP\Text4Scan\x64
    .\Text4Scan.exe /scan /report_sig | Out-Null
}

Get-Content C:\ProgramData\Qualys\Text4Scan\findings.out
""
""
Get-Content C:\ProgramData\Qualys\Text4Scan\summary.out
    $vulnerabilitiesFound = Get-Content C:\ProgramData\Qualys\Text4Scan\summary.out | Select-String -Pattern "vulnerabilitiesFound:"
    $vuln=$vulnerabilitiesFound -split ": "
if ( $vuln[1] -gt 0)
{
    Exit 1337
}
else
{
    Exit 0
}