#!/bin/bash

SECONDS=0

lib_openssl_ver(){
lib_list=$(find / -name $1 -xdev ! -fstype nfs ! -fstype nfs4 ! -fstype cifs ! -fstype smbfs ! -fstype gfs ! -fstype gfs2 ! -fstype safenetfs ! -fstype secfs ! -fstype gpfs ! -fstype smb2 ! -fstype vxfs ! -fstype vxodmfs ! -fstype afs ! -fstype acfs 2>/dev/null)
for i in $lib_list
do
if ! command -v strings &> /dev/null
then
ver=$(grep --text -o 'OpenSSL [[:digit:]][^ ]*' $i|awk '{print $2}' |sort|uniq)
if [[ -n $ver ]]
then
        echo "Path: $i"
        echo "Version(s): $ver"
        echo "----------------------------------------"
	ver_chk=$(echo "$ver"|grep -E "3\.0\.[0-6]" 2>/dev/null)
	if [[ -n $ver_chk ]]
	then
		flag=$((flag+1))
	fi
fi
else
ver=$(strings $i | grep -i -E "^openssl[[:blank:]]+[[:digit:]][^ ]*"| awk '{print $2}'|sort|uniq)
if [[ -n $ver ]]
then
	echo "Path: $i"
        echo "Version(s): $ver"
	echo "----------------------------------------"
        ver_chk=$(echo "$ver"|grep -E "3\.0\.[0-6]" 2>/dev/null)
	if [[ -n $ver_chk ]]
	then 
		flag=$((flag+1))
	fi

fi
fi
done
}

echo "Detecting OpenSSL version in libssl.so* and libcrypto.so*"
echo "----------------------------------------"
flag=0
#Finding OpenSSL version in libssl.so*
lib_openssl_ver libssl.so*
#Finding OpenSSL version in libcrypto.so*
lib_openssl_ver libcrypto.so*
echo "vulnerabilitiesFound: $flag"

duration=$SECONDS
echo -e "\n$(($duration / 60)) minutes and $(($duration % 60)) seconds elapsed in script execution"
