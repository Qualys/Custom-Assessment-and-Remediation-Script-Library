# Proxy credentials
$pass = ConvertTo-SecureString "<Password>" -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential -ArgumentList "<user>", $pass
# Download Text4Scan.zip file
Invoke-WebRequest -Uri "https://github.com/Qualys/Custom-Assessment-and-Remediation-Script-Library/blob/main/Zero%20Day/CVE-2022(OpenSSL)/Windows_Utility/OSSLScan.zip?raw=true" -Proxy http://<ip:port> -ProxyCredential $cred -UseBasicParsing -OutFile $env:TEMP\OSSLScan.exe
# Unzip downloaded file
#Expand-Archive $env:TEMP\Text4Scan.zip -DestinationPath $env:TEMP\

# Start scan process
cd $env:TEMP\
.\OSSLScan.exe /scan /report_sig | Out-Null

Get-Content C:\ProgramData\Qualys\OSSLScan\findings.out
""
""
Get-Content C:\ProgramData\Qualys\OSSLScan\summary.out
    $vulnerabilitiesFound = Get-Content C:\ProgramData\Qualys\OSSLScan\summary.out | Select-String -Pattern "vulnerabilitiesFound:"
    $vuln=$vulnerabilitiesFound -split ": "
if ( $vuln[1] -gt 0)
{
    Exit 1337
}
else
{
    Exit 0
}