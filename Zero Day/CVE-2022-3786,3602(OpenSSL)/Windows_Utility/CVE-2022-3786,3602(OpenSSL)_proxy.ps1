# Proxy credentials
$pass = ConvertTo-SecureString "<Password>" -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential -ArgumentList "<user>", $pass
# Download OSSLScan.zip file
Invoke-WebRequest -Uri "https://github.com/Qualys/osslscanwin/releases/download/1.0.0.0/OSSLScan.zip" -Proxy http://<ip:port> -ProxyCredential $cred -UseBasicParsing -OutFile $env:TEMP\OSSLScan.zip
# Unzip downloaded file
Expand-Archive $env:TEMP\OSSLScan.zip -DestinationPath $env:TEMP\

$Arch = (Get-Process -Id $PID).StartInfo.EnvironmentVariables["PROCESSOR_ARCHITECTURE"];
if ($Arch -eq 'x86') {
    # Start scan process
    cd $env:TEMP\OSSLScan\x86
    .\OSSLScan.exe /scan /report_car | Out-Null
}
elseif ($Arch -eq 'amd64') {
    # Start scan process
    cd $env:TEMP\OSSLScan\x64
    .\OSSLScan.exe /scan /report_car| Out-Null
}

Get-Content C:\ProgramData\Qualys\OSSLScan\car_findings.out
""
""
Get-Content C:\ProgramData\Qualys\OSSLScan\car_summary.out
$vulnerabilitiesFound = Get-Content C:\ProgramData\Qualys\OSSLScan\car_summary.out | Select-String -Pattern "vulnerabilitiesFound:"
$vuln=$vulnerabilitiesFound -split ": "
if ( $vuln[1] -gt 0)
{
    Exit 1337
}
else
{
    Exit 0
}